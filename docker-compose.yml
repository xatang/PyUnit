version: '3.3'

services:
  pyunit:
    image: ${DOCKER_IMAGE}
    container_name: pyunit
    env_file:
      - .env
    ports:
      - "${PORT:-5000}:5000"
    environment:
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - DRYER_LOG_LEVEL=${DRYER_LOG_LEVEL:-INFO}
      - CLEAR_LOGS_ON_STARTUP=${CLEAR_LOGS_ON_STARTUP:-True}
      - API_URL=${API_URL}
      - WS_URL=${WS_URL}
    volumes:
      - pyunit_data:/app/data
      - ./pyunit.db:/app/pyunit.db
      - ./pyunit.db-wal:/app/pyunit.db-wal
      - ./pyunit.db-shm:/app/pyunit.db-shm
      - ./app.log:/app/app.log
      - ./dryer.log:/app/dryer.log
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/docs"]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - pyunit_network

volumes:
  pyunit_data:
    driver: local

networks:
  pyunit_network:
    driver: bridge
